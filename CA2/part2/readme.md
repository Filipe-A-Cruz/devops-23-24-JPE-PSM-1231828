<h1>Class Assignment 2</h1>

---

<h2>Part 2</h2>

This tutorial assumes you've installed gradle beforehand.
If you do not have gradle installed, use the wrapper, e.g. ```$ .\gradlew build``` instead of ```$ gradle build```.

<br/>

<strong>Table of Contents</strong>

1. [Add a task to copy the generated .jar to a folder named ”dist” located in the project root folder level.](#tag1)
2. [Add a task to gradle to delete all the files generated by webpack (located at src/resources/main/static/built/). This new task should be executed automatically by gradle before the task clean.](#tag2)


<br/>

<strong>1. Add a task to copy the generated .jar to a folder named ”dist” located in the project root folder level.</strong> <a id="tag1"></a>

Add the following entry to build.gradle:

```console
task copyJar(type: Copy) {
    from 'build/libs/react-and-spring-data-rest-basic-0.0.1-SNAPSHOT.jar'
    into 'dist'
}
```

To run the task, execute the following command from within the .\CA2\part2 directory:

```console
$ gradle copyJar
```

<br/>

<strong>2. Add a task to gradle to delete all the files generated by webpack (located at src/resources/main/static/built/). This new task should be executed automatically by gradle before the task clean.</strong> <a id="tag2"></a>

Add the following entries to build.gradle:

```console
task deleteWebpackFiles(type: Delete) {
    delete 'src/main/resources/static/built'
}

clean.dependsOn deleteWebpackFiles
```

In addition to the deletion task itself, the line ```clean.dependsOn deleteWebpackFiles``` ensures the deletion is executed whenever ```$ gradle clean``` is called.
Since ```clean``` depends on ```deleteWebpackFiles```, the latter will be executed first.

<br/>

---

<h2>Alternative Solution</h2>

This is my best attempt at building the basic version of the tutorial app using Apache Ant with the Apache Ivy dependency manager.

Apache Ant is a build tool predating Maven and Gradle.
While Ant is known for its flexibility, the lack of a standard project layout forces the developer to manually define the names of all components of the project.
While this may be seen as an advantage for seasoned developers, Ant is generally regarded as unfriendly for beginners.
Furthermore, unlike Maven and Gradle, Ant does not automatically manage the dependencies of dependencies out of the box, relying on the Ivy dependency manager, forcing the build configuration to be split into two files: build.xml for Ant, which delegates dependency management to ivy.xml for Ivy.

Additionally, since Ant has decreased in popularity over the years, especially with the introduction of Maven, the tutorials and other resources for new users are often incomplete or outdated.

<br/>

<strong>Table of Contents</strong>

1. [Ant Installation](#tag3)
2. [Project Setup](#tag4)
3. [ivy.xml Configuration](#tag5)
4. [build.xml Configuration](#tag6)
5. [Where I ran out of time](#tag7)

<br/>

<strong>1. Ant Installation</strong> <a id="tag3"></a>

Download Ant from https://ant.apache.org/bindownload.cgi.
The .zip archive is recommended for Windows.
As of the making of this tutorial, the latest version is 1.10.14.
This version of Ant comes bundled with Ivy 2.5.1.

Unzip the archive to your chosen folder, e.g. ```C:\Program Files\Ant```. 
Assuming you've already installed Java 8 or higher and have set the ```JAVA_HOME``` environment variable, 
set the ```ANT_HOME``` environment variable, e.g. ```C:\Program Files\Ant\apache-ant-1.10.14``` 
and add ```%ANT_HOME%\bin``` to the ```PATH``` environment variable.

From the ```ANT_HOME``` directory, open a command line and run ```$ ant -f fetch.xml -Ddest=system```. 
This will download the library dependencies of the most common Ant tasks and store them at ```ANT_HOME\lib```. 
Additionally, download the Spring Boot AntLib .jar from https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-antlib/3.2.4 
and place it in the ```ANT_HOME\lib``` directory. This module provides basic Spring Boot support for Apache Ant.

You'll also want to install the Ant plugin on your IDE of choice. On IntelliJ, go to File>Settings>Plugins and search for "Ant" on the Marketplace.

<br/>

<strong>2. Project Setup</strong> <a id="tag4"></a>

After you've cloned the tutorial application available at https://github.com/spring-guides/tut-react-and-spring-data-rest, 
create a new folder located at the root of the directory, e.g. ```CA2\alternative```, and copy the ```src``` folder from the basic version of the app, 
as well as the files ```package.json``` and ```webpack.config.js```.

Go to ```src\main\java\com\grelturnquist\payroll\Employee.java``` and edit the following import statements,

```console
import javax.persistence.Entity;
import javax.persistence.GeneratedValue;
import javax.persistence.Id;
```

to

```console
import jakarta.persistence.Entity;
import jakarta.persistence.GeneratedValue;
import jakarta.persistence.Id;
```

Return to ```CA2\alternative``` and create the folder ```lib\loader```.
Download the Spring Boot Loader .jar from https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-loader/3.2.4 
and place it in the newly created folder.

<br/>

<strong>3. ivy.xml Configuration</strong> <a id="tag5"></a>

Create the ```ivy.xml``` located in the folder ```CA2\alternative```. 
This is where dependencies will be declared. 
First you'll need to configure the scope of dependencies, this will help keep the ```lib``` folder organized after being populated by Ivy.

```
<ivy-module version="2.0">
    <info organisation="org.springframework.boot" module="spring-boot-sample-ant"/>
    <configurations>
        <conf name="compile" description="everything needed to compile this module"/>
        <conf name="runtime" extends="compile" description="everything needed to run this module"/>
        <conf name="test" extends="compile" description="everything needed to test this module"/>
    </configurations>
    
    ...
    
</ivy-module>
```

Next you'll want to declare the dependencies, namely, Spring Data JPA, Rest Repositories, Thymeleaf, H2 Database and the Spring Boot Starter Test module, 
which contains libraries such as JUnit, Mockito, Spring Test, etc. 

```
<ivy-module version="2.0">

    ...
    
    <dependencies>
        <dependency org="org.springframework.boot" name="spring-boot-starter-data-jpa"
                    rev="${spring-boot.version}" conf="compile"/>
        <dependency org="org.springframework.boot" name="spring-boot-starter-data-rest"
                    rev="${spring-boot.version}" conf="compile"/>
        <dependency org="org.springframework.boot" name="spring-boot-starter-thymeleaf"
                    rev="${spring-boot.version}" conf="compile"/>
        <dependency org="com.h2database" name="h2"
                    rev="${h2.version}" conf="runtime"/>
        <dependency org="org.springframework.boot" name="spring-boot-starter-test"
                    rev="${spring-boot.version}" conf="test"/>
    </dependencies>
</ivy-module>
```

<br/>

<strong>4. build.xml Configuration</strong> <a id="tag6"></a>

Create the ```build.xml``` located in the folder ```CA2\alternative```. 
First you'll need to declare an additional namespace required by the Spring Boot AntLib module, 
as well as define the name of the project and the default task executed when calling ```$ ant``` with no arguments.
You'll also want to define the ```spring-boot.version``` and ```h2.version``` referenced in ```ivy.xml```.

```
<?xml version="1.0" encoding="UTF-8"?>
<project
        xmlns:ivy="antlib:org.apache.ivy.ant"
        xmlns:spring-boot="antlib:org.springframework.boot.ant"
        name="CA2Alternative" default="build">
    <property name="spring-boot.version" value="3.2.4"/>
    <property name="h2.version" value="2.2.224"/>
    
    ...
    
</project>
```

Next, you'll want to create a set of tasks, beginning with a task that resolves the dependencies declared in ```ivy.xml```.

```
<?xml version="1.0" encoding="UTF-8"?>
<project

    ...
    
    <target name="resolve" description="--> retrieve dependencies with ivy">
        <ivy:retrieve pattern="lib/[conf]/[artifact]-[type]-[revision].[ext]"/>
    </target>
    
    ...
    
</project>
```

You can then define a set of tasks which compile an executable .jar.

```
<?xml version="1.0" encoding="UTF-8"?>
<project

    ...
    
    <target name="classpaths" depends="resolve">
        <path id="compile.classpath">
            <fileset dir="lib/compile" includes="*.jar"/>
        </path>
    </target>

    <target name="init" depends="classpaths">
        <mkdir dir="build/classes"/>
    </target>

    <target name="compile" depends="init" description="compile">
        <javac srcdir="src/main/java" destdir="build/classes" classpathref="compile.classpath"/>
    </target>

    <target name="build" depends="compile">
        <jar destfile="build/${ant.project.name}-${spring-boot.version}.jar" compress="false">
            <mappedresources>
                <fileset dir="build/classes"/>
                <globmapper from="*" to="BOOT-INF/classes/*"/>
            </mappedresources>
            <mappedresources>
                <fileset dir="src/main/resources" erroronmissingdir="false"/>
                <globmapper from="*" to="BOOT-INF/classes/*"/>
            </mappedresources>
            <mappedresources>
                <fileset dir="lib/runtime"/>
                <globmapper from="*" to="BOOT-INF/lib/*"/>
            </mappedresources>
            <zipfileset src="lib/loader/spring-boot-loader-${spring-boot.version}.jar"/>
            <manifest>
                <attribute name="Main-Class" value="org.springframework.boot.loader.launch.JarLauncher"/>
                <attribute name="Start-Class" value="com.greglturnquist.payroll.ReactAndSpringDataRestApplication"/>
            </manifest>
        </jar>
    </target>
    
    ...
    
</project>
```

You'll notice this set of task sequentially depend on each, i.e. build depends on compile, compile depends on and so forth. 
This chained dependence of tasks is somewhat equivalent to the lifecyle of Maven builds.
The build task is especially complex since a standalone executable .jar must be bundled with all the required dependencies,
including the Spring Boot Loader module previously downloaded and stored in the ```lib\loader``` directory.

Finally, create a "clean" task.

```
<?xml version="1.0" encoding="UTF-8"?>
<project

    ...
    
    
    <target name="clean" description="clean up">
        <delete dir="build"/>
    </target>
</project>
```

To build the project, make sure you are in the directory ```CA2\alternative``` and run ```$ ant```. 
Ivy will populate the ```lib``` folder and Ant will subsequently create the executable .jar ```CA2alternative-3.2.4.jar``` 
and place it in the ```build``` directory.

<br/>

<strong>5. Where I ran out of time</strong> <a id="tag7"></a>

Unfortunately, when running the executable .jar, spring will initially boot normally and then launch the following error,

```
Error starting ApplicationContext. To display the condition evaluation report re-run your application with 'debug' enabled.
2024-04-17T23:55:02.372+01:00 ERROR 13852 --- [           main] o.s.b.d.LoggingFailureAnalysisReporter   : 

***************************
APPLICATION FAILED TO START
***************************

Description:

Failed to configure a DataSource: 'url' attribute is not specified and no embedded datasource could be configured.

Reason: Failed to determine a suitable driver class


Action:

Consider the following:
	If you want an embedded database (H2, HSQL or Derby), please put it on the classpath.
	If you have database settings to be loaded from a particular profile you may need to activate it (no profiles are currently active).


Process finished with exit code 1
```

Presumably I could fix this via ```application.properties```, but I ran out of time.

---